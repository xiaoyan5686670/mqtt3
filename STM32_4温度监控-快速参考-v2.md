# STM32_4 温度监控模块 - 快速参考 (v2.0)

## 🎯 核心变更

### 布局
- ❌ v1.0: 4个独立温度卡片
- ✅ v2.0: **2个压缩机组件**

### 告警逻辑
- ❌ v1.0: 单温度 >= 85°F 告警
- ✅ v2.0: **出口温度 < 入口温度 告警**

---

## 📊 组件结构

### 压缩机1组件
```
┌─────────────────────────────────┐
│ 🌀 压缩机1 (Compressor 1)       │
├─────────────────────────────────┤
│  入口温度  →  出口温度           │
│  comp1_in     comp1_out         │
│  75.0 °F      80.0 °F           │
├─────────────────────────────────┤
│  ✓ 正常运行                     │
└─────────────────────────────────┘
```

### 压缩机2组件
```
┌─────────────────────────────────┐
│ 🌀 压缩机2 (Compressor 2)       │
├─────────────────────────────────┤
│  入口温度  →  出口温度           │
│  comp2_in     comp2_out         │
│  78.0 °F      85.0 °F           │
├─────────────────────────────────┤
│  ✓ 正常运行                     │
└─────────────────────────────────┘
```

---

## 🔍 监控字段映射

| 压缩机 | 入口温度字段 | 出口温度字段 |
|--------|------------|------------|
| 压缩机1 | `comp1_in_temperature_F` | `comp1_out_temperature_F` |
| 压缩机2 | `comp2_in_temperature_F` | `comp2_out_temperature_F` |

---

## ⚙️ 判断逻辑

### ✅ 正常状态
```
条件: 出口温度 >= 入口温度
```

**示例**：
```
压缩机1: 入口 75°F, 出口 80°F  (80 >= 75) ✅
压缩机2: 入口 78°F, 出口 85°F  (85 >= 78) ✅
```

**效果**：
- 🌀 风扇旋转（2秒/圈）
- 🟢 绿色边框
- 💚 温度值绿色
- ✅ 显示"✓ 正常运行"

### ⚠️ 异常状态
```
条件: 出口温度 < 入口温度
```

**示例**：
```
压缩机1: 入口 75°F, 出口 70°F  (70 < 75) ⚠️
压缩机2: 入口 85°F, 出口 80°F  (80 < 85) ⚠️
```

**效果**：
- 🛑 风扇停止
- 🔴 红色边框 + 呼吸动画
- ❤️ 温度值红色闪烁
- ⚠️ 显示"⚠ 温度异常 (出口 < 入口)"

---

## 🎨 视觉对比

### 正常 vs 异常

| 元素 | 正常 | 异常 |
|------|------|------|
| 风扇 | 🌀 旋转 | 🛑 停止 |
| 边框 | 🟢 绿色 | 🔴 红色呼吸 |
| 温度值 | 💚 绿色 | ❤️ 红色闪烁 |
| 箭头 | 💜 紫色 | 🔴 红色 |
| 状态 | ✓ 正常运行 | ⚠ 温度异常 |

---

## 📱 响应式布局

| 屏幕 | 布局 | 温度排列 |
|------|------|---------|
| **桌面** (≥768px) | 2列（左右） | 横向 (入口 → 出口) |
| **手机** (<768px) | 1列（上下） | 纵向 (入口 ↓ 出口) |

---

## 🚀 快速测试

### 启动
```bash
cd /Users/qinxiaoyan/work/mqtt3
./start_backend.sh && ./start_frontend.sh
```

### 访问
```
http://192.168.1.102:5173/dashboard
```

### 模拟异常
```bash
# 压缩机1异常
mosquitto_pub -t "stm32_4/data" -m \
  '{"comp1_in_temperature_F": 75, "comp1_out_temperature_F": 70}'
```

---

## 🔧 关键方法

### `getCompressorTemp(num, type)`
获取温度值
- **num**: 1 或 2
- **type**: 'in' 或 'out'
- **返回**: "75.0" 或 "--"

### `isCompressorNormal(num)`
判断是否正常
- **逻辑**: `out >= in`
- **返回**: true 或 false

### `getCompressorGroupClass(num)`
获取样式类
- **返回**: 'compressor-normal' 或 'compressor-abnormal'

---

## 🎯 CSS 关键类

| 类名 | 用途 |
|------|------|
| `.compressor-group` | 组件容器 |
| `.compressor-normal` | 正常状态 |
| `.compressor-abnormal` | 异常状态 |
| `.compressor-fan-icon` | 风扇图标 |
| `.fan-rotating` | 旋转动画 |
| `.temperature-pair` | 温度对容器 |
| `.temp-item` | 单个温度 |
| `.temp-item-value` | 温度数值 |
| `.temp-danger` | 异常温度 |
| `.temp-arrow` | 箭头指示 |

---

## ✅ 检查清单

- [ ] 显示2个压缩机组件
- [ ] 每个组件包含进出口温度
- [ ] 出口 >= 入口时风扇旋转
- [ ] 出口 < 入口时风扇停止
- [ ] 异常时温度闪烁
- [ ] 异常时卡片呼吸动画
- [ ] 状态标签准确
- [ ] 响应式正常
- [ ] 数据每2秒刷新

---

## 🐛 故障排查

| 问题 | 原因 | 解决 |
|------|------|------|
| 不显示 | 设备不存在 | 检查设备名是否为 `stm32_4` |
| 温度为 -- | 数据缺失 | 检查传感器是否上报数据 |
| 风扇不转 | CSS未加载 | 刷新页面 (Ctrl+F5) |
| 一直异常 | 数据错误 | 检查温度数据是否正确 |

---

## 💡 使用示例

### 正常场景
```javascript
// 数据
comp1_in: 75°F
comp1_out: 80°F
comp2_in: 78°F
comp2_out: 85°F

// 结果
压缩机1: ✅ 正常 (80 >= 75)
压缩机2: ✅ 正常 (85 >= 78)
```

### 异常场景
```javascript
// 数据
comp1_in: 75°F
comp1_out: 70°F  ⚠️ 出口 < 入口
comp2_in: 85°F
comp2_out: 80°F  ⚠️ 出口 < 入口

// 结果
压缩机1: ⚠️ 异常 (70 < 75)
压缩机2: ⚠️ 异常 (80 < 85)
```

---

## 🎨 动画参数

| 动画 | 触发条件 | 周期 |
|------|---------|------|
| 风扇旋转 | 正常状态 | 2秒/圈 |
| 温度闪烁 | 异常状态 | 1.5秒 |
| 卡片呼吸 | 异常状态 | 2秒 |
| 数据刷新 | 始终 | 2秒 |

---

## 🔄 与 v1.0 对比

| 项目 | v1.0 | v2.0 |
|------|------|------|
| 卡片数量 | 4个 | 2个 |
| 分组 | 无 | 按压缩机 |
| 告警依据 | 绝对温度 | 相对温度 |
| 温度阈值 | 85°F | 动态（进出口比较） |
| 关联性 | 独立 | 成对 |

---

## 📞 调试命令

### 浏览器控制台
```javascript
// 查看设备
app.$root.$children[0].stm32Device

// 测试压缩机1状态
app.$root.$children[0].isCompressorNormal(1)

// 测试压缩机2状态
app.$root.$children[0].isCompressorNormal(2)

// 获取温度
app.$root.$children[0].getCompressorTemp(1, 'in')
app.$root.$children[0].getCompressorTemp(1, 'out')
```

---

## 📚 相关文档

- **更新说明**: `STM32_4温度监控-更新说明-v2.md`
- **快速参考**: `STM32_4温度监控-快速参考-v2.md` (本文档)
- **v1.0 文档**: 见文档索引

---

## 📌 重点提示

1. ⚠️ 告警逻辑已从"绝对温度"改为"相对温度"
2. 📊 显示从4个卡片改为2个组件
3. 🔗 温度成对显示，更符合业务逻辑
4. 🎨 UI更简洁，信息更清晰

---

**版本**: v2.0  
**更新**: 2026-01-21  
**状态**: ✅ 已完成
