# STM32_4 æ¸©åº¦ç›‘æ§æ¨¡å— - æµ‹è¯•æŒ‡å—

## å‰ç½®æ¡ä»¶

1. âœ… è®¾å¤‡åç§°ä¸º `stm32_4` å·²åœ¨ç³»ç»Ÿä¸­æ³¨å†Œ
2. âœ… è®¾å¤‡æ­£åœ¨ä¸ŠæŠ¥ä»¥ä¸‹4ä¸ªæ¸©åº¦ä¼ æ„Ÿå™¨æ•°æ®ï¼š
   - `comp1_in_temperature_F`
   - `comp2_in_temperature_F`
   - `comp2_out_temperature_F`
   - `comp1_out_temperature_F`

## æµ‹è¯•æ­¥éª¤

### æ­¥éª¤1ï¼šå¯åŠ¨ç³»ç»Ÿ

```bash
# å¦‚æœç³»ç»Ÿæœªå¯åŠ¨ï¼Œå…ˆå¯åŠ¨åç«¯å’Œå‰ç«¯
cd /Users/qinxiaoyan/work/mqtt3

# å¯åŠ¨åç«¯
./start_backend.sh

# å¯åŠ¨å‰ç«¯ï¼ˆæ–°ç»ˆç«¯ï¼‰
./start_frontend.sh
```

### æ­¥éª¤2ï¼šè®¿é—®ä»ªè¡¨æ¿

æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®ï¼š
```
http://192.168.1.102:5173/dashboard
```

### æ­¥éª¤3ï¼šæ£€æŸ¥æ¸©åº¦ç›‘æ§æ¨¡å—

åœ¨ä»ªè¡¨æ¿é¡µé¢é¡¶éƒ¨ï¼ˆç»Ÿè®¡å¡ç‰‡å’Œæœç´¢æ¡†ä¹‹åï¼Œè®¾å¤‡å¡ç‰‡ç½‘æ ¼ä¹‹å‰ï¼‰åº”è¯¥çœ‹åˆ°ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸŒ¡ï¸ stm32_4 - æ¸©åº¦ç›‘æ§                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  [æ¸©åº¦å¡ç‰‡1] [æ¸©åº¦å¡ç‰‡2] [æ¸©åº¦å¡ç‰‡3] [æ¸©åº¦å¡ç‰‡4]         â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ­¥éª¤4ï¼šéªŒè¯æ­£å¸¸çŠ¶æ€æ˜¾ç¤º

**é¢„æœŸæ•ˆæœ**ï¼ˆæ¸©åº¦ < 85Â°Fï¼‰ï¼š
- âœ… é£æ‰‡å›¾æ ‡æŒç»­æ—‹è½¬
- âœ… æ¸©åº¦æ•°å€¼æ˜¾ç¤ºä¸ºç»¿è‰²
- âœ… å¡ç‰‡è¾¹æ¡†ä¸ºç»¿è‰²
- âœ… çŠ¶æ€æ ‡ç­¾æ˜¾ç¤º"âœ“ æ­£å¸¸"
- âœ… å¡ç‰‡èƒŒæ™¯ä¸ºæ·¡ç»¿è‰²æ¸å˜

### æ­¥éª¤5ï¼šéªŒè¯å¼‚å¸¸çŠ¶æ€æ˜¾ç¤º

**æ¨¡æ‹Ÿæ¸©åº¦å¼‚å¸¸**ï¼ˆæœ‰ä»¥ä¸‹æ–¹å¼ï¼‰ï¼š

#### æ–¹å¼Aï¼šä½¿ç”¨MQTTå‘é€æµ‹è¯•æ•°æ®

```bash
# å‘é€é«˜æ¸©æ•°æ®ï¼ˆâ‰¥ 85Â°Fï¼‰
mosquitto_pub -h <MQTTæœåŠ¡å™¨åœ°å€> -t "stm32_4/data" -m '{"comp1_in_temperature_F": 90.0}'
```

#### æ–¹å¼Bï¼šä¿®æ”¹ä»£ç ä¸´æ—¶é™ä½é˜ˆå€¼

ç¼–è¾‘ `Dashboard.vue`ï¼Œå°†é˜ˆå€¼ä¸´æ—¶æ”¹ä¸ºä¸€ä¸ªè¾ƒä½çš„å€¼ï¼ˆå¦‚50ï¼‰ï¼š

```javascript
const isTempNormal = (sensor) => {
  if (!sensor || sensor.value === null || sensor.value === undefined) return false
  return sensor.value < 50  // ä¸´æ—¶æ”¹ä¸º 50 è¿›è¡Œæµ‹è¯•
}
```

**é¢„æœŸæ•ˆæœ**ï¼ˆæ¸©åº¦ â‰¥ 85Â°Fï¼‰ï¼š
- âœ… é£æ‰‡å›¾æ ‡åœæ­¢æ—‹è½¬
- âœ… æ¸©åº¦æ•°å€¼æ˜¾ç¤ºä¸ºçº¢è‰²å¹¶é—ªçƒ
- âœ… å¡ç‰‡è¾¹æ¡†ä¸ºçº¢è‰²ï¼Œå¸¦å‘¼å¸åŠ¨ç”»
- âœ… çŠ¶æ€æ ‡ç­¾æ˜¾ç¤º"âš  å¼‚å¸¸"
- âœ… å¡ç‰‡èƒŒæ™¯ä¸ºæ·¡çº¢è‰²æ¸å˜

### æ­¥éª¤6ï¼šéªŒè¯æ•°æ®åˆ·æ–°

è§‚å¯Ÿæ¸©åº¦æ•°å€¼æ˜¯å¦æ¯2ç§’è‡ªåŠ¨æ›´æ–°ï¼ˆä¸å…¶ä»–è®¾å¤‡å¡ç‰‡åŒæ­¥åˆ·æ–°ï¼‰ã€‚

### æ­¥éª¤7ï¼šéªŒè¯å“åº”å¼å¸ƒå±€

è°ƒæ•´æµè§ˆå™¨çª—å£å¤§å°ï¼ŒéªŒè¯ï¼š
- å¤§å±å¹•ï¼š4åˆ—æ¨ªå‘æ’åˆ—
- ä¸­å±å¹•ï¼š2åˆ—æ’åˆ—
- å°å±å¹•ï¼šå•åˆ—å †å 

## æµ‹è¯•æ£€æŸ¥æ¸…å•

- [ ] æ¸©åº¦ç›‘æ§æ¨¡å—åœ¨ä»ªè¡¨æ¿é¡¶éƒ¨æ­£ç¡®æ˜¾ç¤º
- [ ] 4ä¸ªæ¸©åº¦ä¼ æ„Ÿå™¨å…¨éƒ¨æ˜¾ç¤º
- [ ] æ¸©åº¦æ•°å€¼æ­£ç¡®æ˜¾ç¤ºï¼ˆå¸¦å•ä½ Â°Fï¼‰
- [ ] é£æ‰‡å›¾æ ‡åœ¨æ­£å¸¸çŠ¶æ€ä¸‹æ—‹è½¬
- [ ] é£æ‰‡å›¾æ ‡åœ¨å¼‚å¸¸çŠ¶æ€ä¸‹åœæ­¢æ—‹è½¬
- [ ] æ¸©åº¦å¼‚å¸¸æ—¶æ•°å€¼å˜çº¢å¹¶é—ªçƒ
- [ ] æ¸©åº¦å¼‚å¸¸æ—¶å¡ç‰‡è¾¹æ¡†å˜çº¢å¹¶å‘¼å¸åŠ¨ç”»
- [ ] çŠ¶æ€æ ‡ç­¾æ­£ç¡®æ˜¾ç¤ºï¼ˆæ­£å¸¸/å¼‚å¸¸ï¼‰
- [ ] æ•°æ®æ¯2ç§’è‡ªåŠ¨åˆ·æ–°
- [ ] å“åº”å¼å¸ƒå±€æ­£å¸¸å·¥ä½œ

## æ•…éšœæ’æŸ¥

### é—®é¢˜1ï¼šæ¸©åº¦ç›‘æ§æ¨¡å—ä¸æ˜¾ç¤º

**å¯èƒ½åŸå› **ï¼š
1. è®¾å¤‡åç§°ä¸æ˜¯ `stm32_4`
2. è®¾å¤‡ç¦»çº¿æˆ–ä¸åœ¨ä»ªè¡¨æ¿ä¸­æ˜¾ç¤º

**è§£å†³æ–¹æ³•**ï¼š
```javascript
// æ£€æŸ¥è®¾å¤‡åˆ—è¡¨
console.log('æ‰€æœ‰è®¾å¤‡:', devicesWithSensors.value)

// æ£€æŸ¥æ˜¯å¦æ‰¾åˆ° stm32_4
console.log('STM32è®¾å¤‡:', stm32Device.value)
```

### é—®é¢˜2ï¼šæ¸©åº¦ä¼ æ„Ÿå™¨ä¸æ˜¾ç¤º

**å¯èƒ½åŸå› **ï¼š
1. ä¼ æ„Ÿå™¨ç±»å‹åç§°ä¸åŒ¹é…
2. è®¾å¤‡æ²¡æœ‰ä¸ŠæŠ¥è¿™äº›ä¼ æ„Ÿå™¨æ•°æ®

**è§£å†³æ–¹æ³•**ï¼š
```javascript
// æ£€æŸ¥è®¾å¤‡çš„æ‰€æœ‰ä¼ æ„Ÿå™¨
console.log('è®¾å¤‡ä¼ æ„Ÿå™¨:', stm32Device.value?.sensors)

// æ£€æŸ¥è¿‡æ»¤åçš„æ¸©åº¦ä¼ æ„Ÿå™¨
console.log('æ¸©åº¦ä¼ æ„Ÿå™¨:', stm32TemperatureSensors.value)
```

### é—®é¢˜3ï¼šé£æ‰‡ä¸æ—‹è½¬

**å¯èƒ½åŸå› **ï¼š
1. CSS åŠ¨ç”»æ²¡æœ‰æ­£ç¡®åŠ è½½
2. æµè§ˆå™¨ä¸æ”¯æŒ CSS åŠ¨ç”»

**è§£å†³æ–¹æ³•**ï¼š
- åˆ·æ–°é¡µé¢ï¼ˆCtrl+F5 å¼ºåˆ¶åˆ·æ–°ï¼‰
- æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯
- ä½¿ç”¨ç°ä»£æµè§ˆå™¨ï¼ˆChromeã€Firefoxã€Edgeï¼‰

### é—®é¢˜4ï¼šæ¸©åº¦å•ä½é”™è¯¯

**å¯èƒ½åŸå› **ï¼š
ä¼ æ„Ÿå™¨ä¸ŠæŠ¥çš„æ˜¯æ‘„æ°åº¦ï¼Œä½†æ˜¾ç¤ºä¸ºåæ°åº¦

**è§£å†³æ–¹æ³•**ï¼š
ä¿®æ”¹ `Dashboard.vue` ä¸­çš„å•ä½æ˜¾ç¤ºï¼š
```html
<span class="temp-unit">{{ tempSensor.unit || 'Â°C' }}</span>
```

å¹¶è°ƒæ•´æ¸©åº¦é˜ˆå€¼ï¼š
```javascript
const isTempNormal = (sensor) => {
  // æ‘„æ°åº¦æ­£å¸¸èŒƒå›´ï¼šä½äº 30Â°C
  return sensor.value < 30
}
```

## è°ƒè¯•æŠ€å·§

### 1. æŸ¥çœ‹è®¾å¤‡æ•°æ®

æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12ï¼‰ï¼Œåœ¨ Console æ ‡ç­¾ä¸­è¾“å…¥ï¼š

```javascript
// æŸ¥çœ‹æ‰€æœ‰è®¾å¤‡
app.$root.$children[0].devicesWithSensors

// æŸ¥çœ‹ stm32_4 è®¾å¤‡
app.$root.$children[0].stm32Device

// æŸ¥çœ‹æ¸©åº¦ä¼ æ„Ÿå™¨
app.$root.$children[0].stm32TemperatureSensors
```

### 2. å¼ºåˆ¶è§¦å‘å¼‚å¸¸çŠ¶æ€

åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­ä¸´æ—¶ä¿®æ”¹æ¸©åº¦å€¼ï¼š

```javascript
// è·å–æ¸©åº¦ä¼ æ„Ÿå™¨å¼•ç”¨
const tempSensors = app.$root.$children[0].stm32TemperatureSensors

// ä¿®æ”¹ç¬¬ä¸€ä¸ªæ¸©åº¦ä¸ºå¼‚å¸¸å€¼
if (tempSensors.length > 0) {
  tempSensors[0].value = 95
}
```

### 3. æ£€æŸ¥CSSåŠ¨ç”»

åœ¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·ä¸­ï¼š
1. é€‰æ‹© Elements æ ‡ç­¾
2. æ‰¾åˆ°é£æ‰‡å›¾æ ‡å…ƒç´  (`.temp-fan-icon.fan-rotating`)
3. åœ¨ Computed æ ‡ç­¾ä¸­æŸ¥çœ‹æ˜¯å¦åº”ç”¨äº† `fanRotate` åŠ¨ç”»

## æ€§èƒ½éªŒè¯

ç›‘æ§ä»¥ä¸‹æŒ‡æ ‡ç¡®ä¿æ€§èƒ½è‰¯å¥½ï¼š

1. **é¡µé¢åŠ è½½æ—¶é—´**ï¼š< 3ç§’
2. **æ•°æ®åˆ·æ–°æµç•…åº¦**ï¼šæ— å¡é¡¿
3. **åŠ¨ç”»æµç•…åº¦**ï¼š60fps
4. **å†…å­˜å ç”¨**ï¼šæ— å†…å­˜æ³„æ¼

ä½¿ç”¨æµè§ˆå™¨æ€§èƒ½å·¥å…·ï¼ˆF12 â†’ Performanceï¼‰è¿›è¡Œåˆ†æã€‚

## ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒå‰ï¼š

1. [ ] å®Œæˆæ‰€æœ‰æµ‹è¯•é¡¹
2. [ ] éªŒè¯åœ¨å¤šç§æµè§ˆå™¨ä¸­æ­£å¸¸å·¥ä½œ
3. [ ] éªŒè¯åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šæ­£å¸¸æ˜¾ç¤º
4. [ ] å¤‡ä»½åŸæœ‰ä»£ç 
5. [ ] æ„å»ºç”Ÿäº§ç‰ˆæœ¬

```bash
cd frontend
npm run build
```

## å›æ»šæ–¹æ¡ˆ

å¦‚é‡åˆ°é—®é¢˜éœ€è¦å›æ»šï¼š

```bash
# ä½¿ç”¨ git å›æ»šåˆ°ä¿®æ”¹å‰çš„ç‰ˆæœ¬
git checkout HEAD~1 frontend/src/views/Dashboard.vue

# æˆ–è€…ä»å¤‡ä»½æ¢å¤
cp Dashboard.vue.backup frontend/src/views/Dashboard.vue
```

## è”ç³»æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š
- æµè§ˆå™¨ç±»å‹å’Œç‰ˆæœ¬
- æ§åˆ¶å°é”™è¯¯ä¿¡æ¯æˆªå›¾
- ç½‘ç»œè¯·æ±‚ä¿¡æ¯ï¼ˆF12 â†’ Networkï¼‰
- è®¾å¤‡æ•°æ®ç¤ºä¾‹
