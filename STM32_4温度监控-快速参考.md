# STM32_4 温度监控模块 - 快速参考

## 🎯 功能概述

为设备 **stm32_4** 创建独立温度监控模块，实时监控4个温度传感器，通过动态图标直观显示温度状态。

---

## 📊 监控字段

| 序号 | 传感器类型 | 说明 | 单位 |
|------|-----------|------|------|
| 1 | `comp1_in_temperature_F` | 压缩机1入口温度 | °F |
| 2 | `comp2_in_temperature_F` | 压缩机2入口温度 | °F |
| 3 | `comp2_out_temperature_F` | 压缩机2出口温度 | °F |
| 4 | `comp1_out_temperature_F` | 压缩机1出口温度 | °F |

---

## 🎨 视觉效果对比

### ✅ 正常状态 (< 85°F)
```
┌────────────────┐
│ 🌀 旋转        │  ← 风扇持续旋转
│ 压缩机1入口温度 │
│                │
│  75.0 °F      │  ← 绿色数值
│                │
│ ✓ 正常         │  ← 绿色标签
└────────────────┘
  绿色边框
```

### ⚠️ 异常状态 (≥ 85°F)
```
┌────────────────┐
│ 🛑 停止        │  ← 风扇停止旋转
│ 压缩机2出口温度 │
│                │
│  92.0 °F      │  ← 红色闪烁数值
│                │
│ ⚠ 异常         │  ← 红色标签
└────────────────┘
  红色边框+呼吸动画
```

---

## 🔧 技术参数

| 参数 | 值 |
|------|---|
| 温度阈值 | 85°F (约29.4°C) |
| 数据刷新频率 | 2秒 |
| 风扇旋转速度 | 2秒/圈 |
| 温度闪烁周期 | 1.5秒 |
| 卡片呼吸周期 | 2秒 |

---

## 🎬 动画效果

| 动画类型 | 触发条件 | 效果 | 周期 |
|---------|---------|------|------|
| 风扇旋转 | 温度正常 | 持续顺时针旋转 | 2秒/圈 |
| 温度闪烁 | 温度异常 | 透明度变化 | 1.5秒 |
| 卡片呼吸 | 温度异常 | 阴影大小变化 | 2秒 |

---

## 📱 响应式布局

| 屏幕尺寸 | 布局 | 说明 |
|---------|------|------|
| **超大屏** (≥1200px) | 4列 | 横向排列 |
| **大屏** (992-1199px) | 2列 | 2×2 网格 |
| **中屏** (768-991px) | 2列 | 2×2 网格 |
| **小屏** (<768px) | 1列 | 垂直堆叠 |

---

## 🎨 颜色代码

### 正常状态
```
边框:     #10b981  (绿色)
温度值:   #10b981  (绿色)
背景:     #f0fdf4 → #ffffff (淡绿渐变)
标签:     #10b981  (绿色背景)
```

### 异常状态
```
边框:     #ef4444  (红色)
温度值:   #ef4444  (红色)
背景:     #fef2f2 → #ffffff (淡红渐变)
标签:     #ef4444  (红色背景)
```

---

## 🚀 快速测试

### 1. 启动系统
```bash
cd /Users/qinxiaoyan/work/mqtt3
./start_backend.sh    # 后端
./start_frontend.sh   # 前端（新终端）
```

### 2. 访问仪表板
```
http://192.168.1.102:5173/dashboard
```

### 3. 检查点
- [ ] 温度模块显示在页面顶部
- [ ] 4个温度卡片全部显示
- [ ] 风扇图标正常旋转（正常温度）
- [ ] 温度数值显示正确
- [ ] 状态标签显示准确

---

## ⚙️ 自定义配置

### 修改温度阈值
编辑 `Dashboard.vue` 第 809-813 行：
```javascript
const isTempNormal = (sensor) => {
  if (!sensor || sensor.value === null || sensor.value === undefined) return false
  return sensor.value < 85  // ← 修改这里
}
```

### 修改温度单位
编辑 `Dashboard.vue` 第 27 行：
```html
<span class="temp-unit">{{ tempSensor.unit || '°F' }}</span>
                                              ↑
                                          修改为 '°C'
```

### 修改刷新频率
编辑 `Dashboard.vue` 第 833 行：
```javascript
refreshInterval = setInterval(fetchDevicesWithSensors, 2000)
                                                        ↑
                                                   修改毫秒数
```

---

## 🐛 故障排查速查

| 问题 | 可能原因 | 解决方法 |
|------|---------|---------|
| 模块不显示 | 设备名称不匹配 | 检查设备名是否为 `stm32_4` |
| 温度不显示 | 传感器类型不匹配 | 检查传感器类型名称是否正确 |
| 风扇不旋转 | CSS未加载 | 刷新页面 (Ctrl+F5) |
| 数据不更新 | 后端连接失败 | 检查后端服务是否运行 |

---

## 📂 修改的文件

```
frontend/src/views/Dashboard.vue
├── 模板: 添加温度监控 HTML 结构
├── 脚本: 添加计算属性和方法
└── 样式: 添加温度卡片和动画样式
```

---

## 🔄 数据流

```
MQTT → 后端 → API → Dashboard → 过滤设备 → 过滤传感器 → 渲染卡片
```

---

## 📏 CSS 类名速查

| 类名 | 用途 |
|------|------|
| `.temperature-monitor-card` | 主容器 |
| `.temp-card` | 温度卡片 |
| `.temp-normal` | 正常状态修饰符 |
| `.temp-abnormal` | 异常状态修饰符 |
| `.temp-fan-icon` | 风扇图标 |
| `.fan-rotating` | 旋转动画类 |
| `.temp-value` | 温度数值 |
| `.temp-danger` | 异常温度修饰符 |

---

## 🎯 关键代码位置

| 功能 | 文件位置 |
|------|---------|
| 温度监控HTML | `Dashboard.vue` 第 86-118 行 |
| 设备查找逻辑 | `Dashboard.vue` 第 801-808 行 |
| 温度过滤逻辑 | `Dashboard.vue` 第 810-821 行 |
| 温度判断逻辑 | `Dashboard.vue` 第 823-827 行 |
| 温度卡片样式 | `Dashboard.vue` 第 1245-1399 行 |

---

## 📞 调试命令

### 浏览器控制台
```javascript
// 查看所有设备
app.$root.$children[0].devicesWithSensors

// 查看 stm32_4 设备
app.$root.$children[0].stm32Device

// 查看温度传感器
app.$root.$children[0].stm32TemperatureSensors
```

### 后端 API
```bash
# 获取最新传感器数据
curl http://localhost:8000/api/v1/sensors/latest

# 获取设备列表
curl http://localhost:8000/api/v1/devices
```

---

## ✅ 测试清单

- [ ] 模块在页面顶部显示
- [ ] 4个温度传感器全部显示
- [ ] 温度值正确显示（带单位）
- [ ] 正常状态：风扇旋转
- [ ] 正常状态：绿色主题
- [ ] 异常状态：风扇停止
- [ ] 异常状态：红色闪烁
- [ ] 异常状态：卡片呼吸动画
- [ ] 状态标签准确
- [ ] 数据每2秒刷新
- [ ] 响应式布局正常
- [ ] 移动端显示正常

---

## 📚 相关文档

- **详细说明**: `STM32_4温度监控模块说明.md`
- **测试指南**: `STM32_4温度监控-测试指南.md`
- **可视化示意**: `STM32_4温度监控-可视化示意.md`
- **快速参考**: `STM32_4温度监控-快速参考.md` (本文档)

---

## 💡 提示

- 温度阈值可根据实际需求调整
- 风扇图标使用 Font Awesome 的 `fa-fan`
- 所有动画使用纯 CSS3，无需 JavaScript
- 支持实时数据更新，无需刷新页面

---

## 📌 重要提醒

1. 确保设备名称准确匹配 `stm32_4`
2. 传感器类型名称必须完全一致
3. 温度单位默认为华氏度 (°F)
4. 数据刷新依赖后端 API 正常运行
5. 使用现代浏览器以获得最佳体验

---

**最后更新**: 2026-01-21  
**版本**: 1.0.0  
**状态**: ✅ 已实现并测试
